<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscription and Sign-Up Flow</title>
  <script src="./jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="stylesheet" href="signup_styles.css" />
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <div class="multi-page-container content">
     <!-- Page 1: User Information Form -->
    
      <!-- ........................................ONE......................... -->
      <section class="page" id="page-1">
        <!-- <div class="container">   -->
          <div class="container">  
            <div class="form-container">  
                <div class="logo">  
                    <img src="https://d2c512779vw9nw.cloudfront.net/text.png" alt="Kdnplus Logo" />  
                </div>  
                <h1>Get started now</h1>  
                <p>Sign up now for a seamless and rewarding experience</p>  
                <form>  
                    <div class="user-info-container">  
                        <div class="input-group">  
                            <div class="name-field">  
                                <label for="username">Username</label>  
                                <input type="text" id="username" placeholder="Username" required/>  
                            </div>  
                            <div class="name-field">  
                                <label for="first-name">First Name</label>  
                                <input type="text" id="first-name" placeholder="First Name" required/>  
                            </div>  
                        </div>  
                        <div class="input-group">  
                            <div class="name-field">  
                                <label for="middle-name">Middle Name</label>  
                                <input type="text" id="middle-name" placeholder="Middle Name" required/>  
                            </div>  
                            <div class="name-field">  
                                <label for="last-name">Last Name</label>  
                                <input type="text" id="last-name" placeholder="Last Name" required/>  
                            </div>  
                        </div>  
                        <div class="input-group">  
                            <div class="name-field">  
                                <label for="email">Email</label>  
                                <input type="email" id="email" placeholder="Email Address" required/>  
                            </div>  
                            <div class="name-field">  
                                <label for="password">Password</label>  
                                <input type="password" id="password" placeholder="Password" required/>  
                            </div>  
                        </div>  
                      </div>  
                      <button type="button" class="next-btn fb1" onclick="goToPage(2)">Get Started</button>  
                     
                      <div class="divider-container">  
                        <hr class="line">  
                        <span class="or-text">or</span>  
                        <hr class="line">  
                    </div> 
  
                    <div class="social-signup">  
                        <button type="button" class="facebook-btn fb1">  
                            <i class="fab fa-facebook-f"></i>&nbsp; &nbsp; Sign Up with <span class="fbb">Facebook</span>  
                        </button>  
                    </div>  
                    <p class="center-text">  
                        Already have an Account? <a href="../login/login.html">Sign In</a>  
                    </p>  
                </form>  
            </div>  
            <div class="image-container">  
                <img src="New Project (3).png" alt="KDNPlus Background" />  
            </div>  
        </div>  
      </section>    
        <!-- ........................................ONE......................... -->
        <!-- Page 2: Subscription Plan -->
        <div class="page" id="page-2">
          <div class="container">  
            <div class="form-container">  
                <div class="logo">  
                    <img src="https://d2c512779vw9nw.cloudfront.net/text.png" alt="Kdnplus Logo" />  
                </div>  
                <h1>Choose Your Right Plan</h1>  
                <p>Select from best plans,ensuring a perfect match</p>  
                <div class="subscription-plan plan-box" id="plan-1">
                  <div class="plan-header">
                    <h2>Basic Plan</h2>
                    <button class="change-plan-btn">✏️ Change Plan</button>
                  </div>
                  <p class="plan-price">
                    ₦ 2,700 &nbsp; Unlimited Access &nbsp; 1 Month
                  </p>
                  <ul class="plan-features">
                    <li>480-720p Streaming</li>
                    <li>Full Captioning</li>
                    <li>Average quality streaming</li>
                    <li>Access to all movies and shows</li>
                    <li>1 profile / 1 screen per account</li>
                  </ul>
                  <hr /> <br>
                  <p>Your subscription will be renewed monthly</p>
                  <div class="total-fee">
                    <p>Total Fee</p>
                    <p class="price">₦ 2,700</p>
                  </div> <br>
                  <button class="next-btn" onclick="goToPage(3)">Next</button>
                </div>
        
                <!-- Standard Plan -->
                <div
                  class="subscription-plan plan-box"
                  style="display: none"
                  id="plan-2"
                >
                  <div class="plan-header">
                    <h3>Standard Plan</h3>
                    <button class="change-plan-btn">✏️ Change Plan</button>
                  </div>
                  <p class="plan-price">
                    ₦ 3,500 &nbsp; Unlimited Access &nbsp; 1 Month
                  </p>
                  <ul class="plan-features">
                    <li>Full HD Streaming</li>
                    <li>2 screens per account</li>
                    <li>Full Captioning</li>
                    <li>Access to all movies and shows</li>
                    <li>Multiple profiles</li>
                  </ul>
                  <hr /> <br>
                  <p>Your subscription will be renewed monthly</p>
                  <div class="total-fee">
                    <p>Total Fee</p>
                    <p class="price">₦ 3,500</p>
                  </div> <br>
                  <button class="next-btn" onclick="goToPage(3)">Next</button>
                </div>
        
                <!-- Premium Plan -->
                <div
                  class="subscription-plan plan-box"
                  style="display: none"
                  id="plan-3"
                >
                  <div class="plan-header">
                    <h3>Premium Plan</h3>
                    <button class="change-plan-btn">✏️ Change Plan</button>
                  </div>
                  <p class="plan-price">
                    ₦ 5,000 &nbsp; Unlimited Access &nbsp; 1 Month
                  </p>
                  <ul class="plan-features">
                    <li>4K Ultra HD Streaming</li>
                    <li>4 screens per account</li>
                    <li>Full Captioning</li>
                    <li>Access to all movies and shows</li>
                    <li>Multiple profiles</li>
                  </ul>
                  <hr /> <br>
                  <p>Your subscription will be renewed monthly</p>
                  <div class="total-fee">
                    <p>Total Fee</p>
                    <p class="price">₦ 5,000</p>
                  </div> <br>
                  <button class="next-btn" onclick="goToPage(3)">Next</button>
                </div>
               
            </div>  
            <br>
            <div class="image-container plann-two">  <!--plann-two is just to control the img with style -->
                <img src="New Project (3).png" alt="KDNPlus Background" />  
            </div>  
        </div>  
        </div>

   <!-- Page 3: Payment Details -->
<div class="page" id="page-3">
  <div class="container-last">
    <div class="logo">
      <img src="https://d2c512779vw9nw.cloudfront.net/text.png" alt="Kdnplus Logo">
    </div>
    <div class="flex-container">
      <div class="payment-details">
        <h2>Payment Details</h2>
        <!-- Payment form with Stripe integration -->
        <form id="payment-form">
          <br>
          <label for="full-name" class="full-name">Full Name</label>
          <input type="text" id="full-name" name="full-name" placeholder="Full Name" required>
          <br><br>
          
          <!-- Stripe Card Element Placeholder -->
          <label for="card-element">Card Details</label>
          <div id="card-element">
            <!-- Stripe will inject the Card Element here -->
          </div>
          <div id="card-errors" role="alert" style="color: red; margin-top: 10px;"></div>
          
          <br>
          <label for="location">Address</label>
          <input type="text" id="location" name="location" placeholder="Address" required>

          <!-- Submit and Cancel buttons with functionality -->
          <div class="submit-cancel-buttons">
            <button type="button" class="cancel-btn bt1" onclick="goToPage(2)">Cancel</button>
            <button type="submit" class="submit-btn bt1 bt2">Pay Now</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Include the Stripe.js library -->
<script src="https://js.stripe.com/v3/"></script>
<script src="./signup_script.js"></script>
<script>
  // Initialize Stripe with your publishable key
  const stripe = Stripe("your-publishable-key"); // Replace with your actual Stripe publishable key
  const elements = stripe.elements();

  // Create an instance of the card Element and mount it
  const cardElement = elements.create("card");
  cardElement.mount("#card-element");

  // Handle form submission
  const form = document.getElementById("payment-form");
  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    // Create a Payment Method using the card details
    const { paymentMethod, error } = await stripe.createPaymentMethod({
      type: 'card',
      card: cardElement,
      billing_details: {
        name: document.getElementById("full-name").value,
      },
    });

    if (error) {
      // Display error message in the card-errors div
      document.getElementById("card-errors").textContent = `Invalid card details. Please check and try again. ${error.message}`;
    } else {
      console.log("Payment Method created successfully:", paymentMethod);

      // Send the payment data and Payment Method ID to the backend
      const response = await fetch("http://localhost:3000/api/create-payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          amount: 2000, // Amount in cents (e.g., 2000 for $20.00)
          currency: 'usd',
          paymentMethodId: paymentMethod.id, // Use the generated Payment Method ID
        }),
      });

      const paymentResult = await response.json();

      if (paymentResult.message === "Payment successful") {
        // Redirect to the login page on successful payment
        window.location.href = "/login.html";
      } else {
        alert("Payment failed. Please try again.");
      }
    }
  });
</script>

  </script>
</body>
</html>
